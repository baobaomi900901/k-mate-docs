# 数据

## 保留历史数据(天)<span id ="保留历史数据"></span>

`保留历史数据(天)`指历史数据保留天数，默认30天，可自定义进行修改。

`保留历史数据(天)`功能既与【任务配置】-“系统任务”-“清除数据”搭配使用，又与`保存采集数据(天)`的设置有关联，具体效果如下所示：

- 当保留天数设置为0时，执行“清除数据”自动任务，则保留的是当天及之前所有的指标历史数据。
- 当保留天数设置为1或1以上，执行“清除数据”自动任务，保留的是当天及所设置天数之前的所有指标历史数据。
- 当“保存采集数据(天)”项数据大于“保留历史数据(天)”项数据时，系统会以“保存采集数据(天)”项的数据做为历史保留天数。例如：当采集数据天数为20，历史数据天数为10，清除数据后，系统则保留从当天起的前20天的历史数据。

不同数据库清除的数据内容，如下：

- Sqlite 数据库
  - 清除 “Server\Data\History” 路径下的指定天数的 “.db” 文件。
  - 清除 “Server\Data\DBFile” 路径下带 R 的文件夹中的数据，如 “FlowR” 、“ReportR” 等带 R 的数据。
- 其他数据库：
  - 按照对应保留的数据天数，清除历史库当中超过该天数的数据（如指标、流程执行数据等等）。
  - 清除 “Server\Data\DBFile” 路径下带 R 的文件夹中的数据，如 “FlowR” 、“ReportR” 等带 R 的数据。

## 保存采集数据(天)<span id ="保存采集数据"></span>

采集数据指的是指标和事件的数据，即监控文件数据。由于采集数据产生的数据过大，保存的时间不需要和其他历史数据一样久，所以用此开关可以单独设置监控数据的保存天数，默认30天，可自定义修改天数。

当保存天数设置为0时，则保存的数据是当天及之前的所有采集的指标和事件的数据；如果保存天数设置为30天，则保存的数据是从当天起的前30天的数据。

>**[info] 提示**
>
><span> &emsp;</span><font color="black">此处清除的数据是 “Detailed.db” 文件下的指标运行表和任务运行表指定天数的数据。</font>

## 保存作业设计数据(天)<span id ="保存作业设计数据"></span>

【任务配置】自动任务执行数据保留天数，默认180天（天数从当天日期算起），可自定义修改天数。该数据指的是在【任务配置】界面中显示的执行数据，自动任务的真是执行历史数据并不会被删除。

如果保存天数设置为0，则保存的是当天及其之前所有的任务执行数据。

例如：设置保存180天的数据，180天前执行了流程 a，此时在【任务配置】界面当中无法查看流程 a 在180天前的执行数据，但是在流程的执行历史界面中仍然可以查看到。

>**[info] 提示**
>
><span> &emsp;</span><font color="black">此处清除的数据是 “Detailed.db” 文件下的指标运行表和任务运行表指定天数的数据。</font>

## 保留日志数据(天)<span id ="保留日志数据"></span>

日志数据保留天数，天数从当前日期开始算起。默认设置0天，如果保留天数设置为0，则保存的是当天及之前所有的任务执行数据。

代理端：每个早上3点清除一次；

控制台：登录时清除一次；

服务器：设置清除数据作业任务。

清除的日志数据为logs文件夹下的数据，如代理端清除日志数据的路径为 “Agent\logs”，控制台清除日志数据的路径为 “Control\logs”，服务器清除日志数据的路径为 “Server\logs”。

## 数据备份设置

默认不启用数据备份。

单击“点击设置”，在弹窗中进行相关配置：

- 数据备份

  勾选`启用数据备份`，填上备份路径（备份路径填写到目录即可），在【数据管理】界面，单击“清除”，勾选需要清除的历史库数据，此时将会把所勾选的清除前的历史库数据备份到该路径下。

  

- 备份历史天数

  可自定义选择需要备份的历史天数，有0天、2天、5天三中情况供选择，如下：

  0天：不备份历史库（History）

  2天：备份2天的历史库数据，即执行当天和执行前1天的历史库数据。

  5天：备份5天的历史库数据，即执行当天和执行前4天的历史库数据。

  具体操作如下：

  当填写完备份的历史天数后，在【任务配置】界面，“所有任务”-“系统任务”-“备份数据”设置自动任务，待自动任务执行成功后，将会备份指定天数的历史库数据，数据备份的路径为：“Server\Backup”。

> **[warning] 注意**
>
> <span> &emsp;</span><font color="black">数据备份设置弹窗中，“启用数据备份”和“备份历史天数”两者之间无任何关联，为两个独立的功能。</font>

## 备份基线数据

- 勾选`备份基线数据`，则在自动执行同步数据任务和手工备份数据时会备份基线数据。
- 不勾选`备份基线数据`，则不会备份基线数据，默认不勾选`备份基线数据`。

## 同步数据

填写同步数据的 IP 地址，并且可以通过单击测试连接按钮来测试此 IP 地址是否可以连接成功，在进行自动任务时会把数据同步到测试成功的 IP 地址上。

## HTTP不允许访问服务器目录文件<span id ="http不允许访问服务器目录文件"></span>

该功能可对服务器目录下的文件设置访问权限，默认不勾选。

- 勾选` HTTP 不允许访问服务器目录文件`，仅可访问 web、白名单、temp临时目录、资源目录、制品库以及文件（需要使用制品库版本logo），其他都不允许访问。例如：用户不可以在浏览器地址直接访问 Server 目录下 Config.ini 文件，在浏览器输入 http://服务器IP:端口/Config.ini ，显示“无效权限”。

  

- 不勾选` HTTP 不允许访问服务器目录文件`，则可访问 web、白名单、temp临时目录、资源目录、制品库（需要使用制品库版本logo）以及 “...Data/DBFile” 目录里的文件，其他不允许访问。例如：在浏览器输入  http://服务器IP:端口/Data/DBFile/BigScreen/0FE63F6C25F24B0CA877B8EB2A1CDA6E ，可显示该文件内容。

  
  
  

## 保留备份数据(天)<span id ="保留备份数据"></span>

`保留备份数据(天)`功能与【任务配置】中的”清除数据“搭配使用。

备份数据保留天数，默认为0天，可自定义进行修改。

若保留天数设置为0天，则保存的是当天及之前的所有的备份数据；

若保留天数设置为30天，则保留的备份数据是从当天起的前30天的数据。

1. 在【系统设置】设置了保留备份数据天数后。
2. 在【任务配置】-”系统任务“配置”清除数据“的自动任务，执行”清除数据“任务后，备份天数以外的数据将会被清除，可在“Server\Backup” 路径下查看结果。

## 保留服务端临时目录文件(天)<span id ="保留服务端临时目录文件"></span>

`保留服务端临时目录文件(天)`功能与【任务配置】-系统任务-清除数据搭配使用，执行自动任务后，将清除“/server/Temp”目录下的不带后缀的文件。文件具体的清除情况，取决于`保留服务端临时目录文件(天)`中天数的设置。

如下图所示，带后缀的文件和文件夹都将不会被清除。



在`保留服务端临时目录文件(天)`后方的编辑框中，按F2进入编辑状态：

- 天数设置为0：（默认设置天数为0）

   若天数设置为0，到【任务配置】界面配置“清除数据”系统任务，任务执行后，则不清除任何临时文件。

- 天数设置为1或1以上：

  若天数设置为30，到【任务配置】界面配置“清除数据”系统任务，任务执行后，则保留30天内的所有文件，清除超过30天的所有不带后缀的文件。

## 保留流程录屏文件(天)<span id ="保留流程录屏文件"></span>

`保留流程录屏文件`功能需与【任务配置】-“系统任务”-“清除数据”搭配使用。设置“保留流程录屏天数”，执行“清除数据”自动任务后，会清除“Agent/Video”目录下超过保留时间的录屏文件。

> **[warning] 注意**
>
> - <font color="black"> 录屏文件指Video文件夹下的视频和dat文件，下图文件夹内的视频以及dat文件都将被清除。</font>
>
>   
>
>   
>
> - <font color="black"> 默认设置天数为0，若保留天数设置为0时，则不做清除操作。</font>
> - <font color="black"> 保留天数的时间计算会精确到秒，设置时需满足：（清除任务执行时间 - 可清除文件的时间） > 保留天数，公式为：`可保留的录屏文件时间 = （任务执行时间-保留天数-固定值1天）`，即日期小于`可保留的录屏文件时间`的录屏文件会被清除。例如：设置保留天数为1时，清除数据任务执行时间为：2023-04-20 10:59:00，则（2023-04-20 10:59:00）- 1天 - 固定值1天 = 2023-04-18 10:59:00，即2023-04-18 10:59:00之前的录屏文件才会被清除。</font>
>


具体效果如下所示：

设置了`保留流程录屏文件(天)`：

- 执行“清除数据”自动任务后，只清除“Agent/Video”目录下超过保留时间的录屏文件；

- 若设置了`视频保存位置`，执行“清除数据”自动任务后，会清除所设置的“视频保存位置”目录以及“Agent/Video”目录下超过保留时间的录屏文件；
- 若设置了`视频保存位置`和`视频录制存服务器`，则会忽略`视频保存位置`项指定的保存位置，执行“清除数据”自动任务后，会清除除“Server/Data/DBFile/Video”目录以及“Agent/Video”目录下超过保留时间的录屏文件。



## Nas盘集群文件目录

该系统设置可用于修改 Server 临时文件存放的目录。使用该设置后，会将默认存放在 “Server\Data\DBFile” 目录下的临时文件存储到 “Nas盘集群文件目录” 配置的存放路径中。

> **[warning]  注意**
>
> <span>&emsp;</span><font color="black">若启用该设置存放数据到指定目录后再关闭，则之前存到该目录下的数据是无法读取的，除非再次启用并配置原来的存放路径。</font>



操作说明如下：

> **[info]  说明**
>
> <span>&emsp;</span><font color="black">例子说明：执行勾选了录屏功能的流程后，产生的临时文件存放路径从默认的目录修改至指定新目录下。</font>

1.启用 ”Nas盘集群文件目录“ 设置

在【系统设置】-“数据”分组下，单击“Nas盘集群文件目录” 设置，填写 Server 临时文件存放的目录。



2.执行流程时勾选“录频”执行选项

在【流程设计】界面启用勾选“录屏”执行选项，执行流程后会产生录制文件等临时文件数据。



3.临时文件存放在指定目录下

此时，执行流程后原来存放在默认目录（“Server\Data\DBFile”）下的临时文件已被存储到”Nas盘集群文件目录“ 设置的目录下，原默认目录下不存在新增的临时文件数据，即 Server 临时文件存放的目录已被修改至新目录下。





## 主备同时清除数据

由于原先的主备环境下，主机有清除数据机制，备机没有清除数据机制，会导致备机数据积累过多，因此增加此开关可以进行主备同时清除数据。
- 勾选`主备同时清除数据`，则主备环境下，用户在主机【任务配置】界面配置“清除数据”系统任务，任务执行时，主机依照主机【系统设置】的配置进行清除数据后，备机依照备机【系统设置】的配置进行清除数据。
- 不勾选`主备同时清除数据`，则主备环境下，用户在主机【任务配置】界面配置“清除数据”系统任务，任务执行时，主机会清除数据，备机不会清除数据。默认不勾选`主备同时清除数据`。

>**[info] 说明**
>
> - <span> &emsp;</span><font color="black">当主机同步备机后，主备机的系统配置相同，此时执行“清除数据”系统任务，主备机按照相同的配置清除数据。</font>
> - <span> &emsp;</span><font color="black">当主机修改系统配置，且未执行同步备机的操作时，主备机的配置可能存在差异；此时执行“清除数据”系统任务，主机依照主机的配置进行清除数据，备机依照备机的配置进行清除数据。</font>